<!DOCTYPE html>
<html lang="pt-br">
<head>
    
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

  	<meta property="og:title" content=" TDD in practice with PHPUnit &middot;  Guilherme Guitte" />
  	<meta property="og:site_name" content="Guilherme Guitte" />
  	<meta property="og:url" content="http://localhost:1313/tdd-in-practice-with-phpunit/" />
    
    
  	<meta property="og:type" content="article" />

    <meta property="og:article:published_time" content="2015-08-03T07:53:25-03:00" />

    
    

  <title>
     TDD in practice with PHPUnit &middot;  Guilherme Guitte
  </title>

    <meta name="description" content="" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="http://localhost:1313/images/favicon.ico">
	  <link rel="apple-touch-icon" href="http://localhost:1313/images/apple-touch-icon.png" />
    
    <link rel="stylesheet" type="text/css" href="http://localhost:1313/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="http://localhost:1313/css/nav.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400|Inconsolata" />


    
      
          <link href="http://localhost:1313/index.xml" rel="alternate" type="application/rss+xml" title="Guilherme Guitte" />
      
      
    
    <meta name="generator" content="Hugo 0.14" />

    <link rel="canonical" href="http://localhost:1313/tdd-in-practice-with-phpunit/" />

    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-53977349-1', 'auto');
      ga('send', 'pageview');

    </script>
    
</head>
<body class="nav-closed">

  <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        
        
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/">Blog</a>
            </li>
        
            <h3>Follow me</h3>
            <li class="nav-opened" role="presentation">
            	<a href="https://github.com/GuilhermeGuitte">Github repos</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://twitter.com/GuilhermeGuitte">Twitter timeline</a>
            </li>
        
    </ul>
    
    
    <a class="subscribe-button icon-feed" href="http://localhost:1313/index.xml">Subscribe</a>
    
</div>
<span class="nav-cover"></span>


 <div class="site-wrapper">



<header class="main-header post-head no-cover">
  <nav class="main-nav clearfix">


  
  
      <a class="menu-button" href="#"><span class="burger">&#9776;</span><span class="word">Menu</span></a>
  
  </nav>
</header>



<main class="content" role="main">




  <article class="post post">

    <header class="post-header">
        <h1 class="post-title">TDD in practice with PHPUnit</h1>
        <small></small>

        <section class="post-meta">
        
          <time class="post-date" datetime="2015-08-03T07:53:25-03:00">
            Aug 3, 2015
          </time>
        
         
        </section>
    </header>
  
    <section class="post-content">
      

<p>TDD has become an essential practice for developers to have more confidence
and engage practices such as refactoring. For example, if you updated
some critical library in our application, you can run all tests to see
if some implementation has been broken.</p>

<p>According to wikipedia:</p>

<blockquote>
<p>Test-driven development (TDD) is a software development process that relies on the
<strong>repetition</strong> of a very short development cycle: first the developer writes an (initially failing)
<strong>automated test</strong> case that defines a desired improvement or new function, then produces the minimum
amount of code to pass that test, and finally <strong>refactors</strong> the new code to acceptable standards.
Kent Beck, who is credited with having developed or &lsquo;rediscovered&rsquo; the technique, stated in 2003 that
TDD encourages simple designs and inspires confidence.</p>
</blockquote>

<p>This tutorial aimed to drive the process of TDD in practice, demonstrating the following topics:</p>

<ul>
<li>The basic concept about RED-GREEN-REFACTOR cycle;</li>
<li>Setup our testing tools (in this case PHPUnit);</li>
<li>Basic structure of a Test classes;</li>
<li>Creating some concrete features, applying TDD.</li>
</ul>

<h2 id="basic-concept-of-tdd:2a5133cef429eb10f27e53c1a6baa385">Basic concept of TDD</h2>

<p>I will explain in-short, what you should know about TDD to put in practice.</p>

<p>TDD has a concept called RED-GREEN-REFACTOR.</p>

<p><img src="http://wrozka.github.io/ppppp-pair-programming/img/red-green-refactor.png" alt="" /></p>

<h3 id="red-phase:2a5133cef429eb10f27e53c1a6baa385">RED phase:</h3>

<ul>
<li>Write the test of a new feature or a bug to be fixed;</li>
<li>Run the tests. The new one are going to fail.</li>
</ul>

<h3 id="green-phase:2a5133cef429eb10f27e53c1a6baa385">GREEN phase:</h3>

<ul>
<li>Write the code needed to match the test&rsquo;s expectations.</li>
<li>Run the tests. Now the newly written test should be passing.</li>
</ul>

<h3 id="refactor-phase:2a5133cef429eb10f27e53c1a6baa385">REFACTOR phase:</h3>

<ul>
<li>Refactor the code written to become more well written, abstract repetition, DRY it, etc.</li>
</ul>

<p>You will see that this cycle will performed several times.</p>

<p>Let&rsquo;s create the basic structure for our application.</p>

<h2 id="creating-the-folder-structure:2a5133cef429eb10f27e53c1a6baa385">Creating the Folder structure</h2>

<p>First at all, let&rsquo;s create the following folder structure:</p>

<p><img src="https://dl.dropboxusercontent.com/u/106483810/tdd-phpunit-first-steps/Captura%20de%20Tela%202014-08-20%20%C3%A0s%2010.32.09.png" alt="" /></p>

<h2 id="installing-composer:2a5133cef429eb10f27e53c1a6baa385">Installing Composer</h2>

<p>Before getting started, install <a href="https://getcomposer.org/">Composer</a>.</p>

<pre><code>$ curl -sS https://getcomposer.org/installer | php
</code></pre>

<p>Inside the root&rsquo;s project folder, create the <code>composer.json</code>.</p>

<pre><code>{
    &quot;name&quot;: &quot;guilhermeguitte/tdd-first-steps&quot;,
    &quot;description&quot;: &quot;A simple introduction explain how to apply TDD with PHPUnit.&quot;,
    &quot;license&quot;: &quot;MIT&quot;,
    &quot;authors&quot;: [
        {
            &quot;name&quot;: &quot;Guilherme Guitte&quot;,
            &quot;email&quot;: &quot;guilherme.guitte@gmail.com&quot;
        }
    ],
    &quot;minimum-stability&quot;: &quot;stable&quot;,
    &quot;require-dev&quot;: {
    }
}
</code></pre>

<h2 id="installing-phpunit:2a5133cef429eb10f27e53c1a6baa385">Installing PHPUnit</h2>

<p>Now, add at <code>require-dev</code> the <code>phpunit</code> dependency.</p>

<pre><code>&quot;require-dev&quot;: {
    &quot;phpunit/phpunit&quot;: &quot;4.2.*&quot;
}
</code></pre>

<p>Run in console <code>composer install</code> to add all dependencies:</p>

<pre><code>$ composer.phar install --dev
</code></pre>

<p>Create the file <code>phpunit.xml</code> in root directory. PHPUnit need to know where our tests files are located and which configuration to use.</p>

<pre><code>&lt;phpunit
         backupGlobals=&quot;false&quot;
         backupStaticAttributes=&quot;false&quot;
         bootstrap=&quot;vendor/autoload.php&quot;
         colors=&quot;true&quot;
         convertErrorsToExceptions=&quot;true&quot;
         convertNoticesToExceptions=&quot;true&quot;
         convertWarningsToExceptions=&quot;true&quot;
&gt;
   &lt;testsuites&gt;
     &lt;testsuite&gt;
       &lt;directory&gt;tests/&lt;/directory&gt;
     &lt;/testsuite&gt;
   &lt;/testsuites&gt;
&lt;/phpunit&gt;
</code></pre>

<p>The final folder structure should be equals to:</p>

<p><img src="https://dl.dropboxusercontent.com/u/106483810/tdd-phpunit-first-steps/Captura%20de%20Tela%202014-08-20%20%C3%A0s%2010.54.46.png" alt="" /></p>

<h3 id="test-s-file-structure:2a5133cef429eb10f27e53c1a6baa385">Test&rsquo;s file structure</h3>

<p>See the example of Test class below:</p>

<pre><code>&lt;?php

class BasicExampleTest extends PHPUnit_Framework_TestCase
{
    public function testSomeThing() {}
    public function nonTest() {}
}
</code></pre>

<p>The class definition above, is the way we should create our Test classes.
We have to extend <code>PHPUnit_Framework_TestCase</code> to be able to use the set of tools that
PHPUnit provides.</p>

<p>Only the methods that have the <code>test</code> prefix will be called by PHPUnit. So the method <code>testSomeThing()</code> will be called.</p>

<p>Now running the <code>vendor/bin/phpunit</code> command:</p>

<pre><code>$ vendor/bin/phpunit
</code></pre>

<p>We will see:</p>

<p><img src="https://dl.dropboxusercontent.com/u/106483810/tdd-phpunit-first-steps/Captura%20de%20Tela%202014-08-20%20%C3%A0s%2011.17.48.png" alt="" /></p>

<p>At this point, we have did the setup of our application with PHPUnit, now we can create something concrete.</p>

<h3 id="commit-it:2a5133cef429eb10f27e53c1a6baa385">Commit it</h3>

<p>Please, commit this changes:</p>

<pre><code>$ git init
$ git add -A .
$ git commit -m 'basic structure'
</code></pre>

<h3 id="the-feature-s-scope:2a5133cef429eb10f27e53c1a6baa385">The Feature&rsquo;s scope</h3>

<p>Until now, we&rsquo;ve seen a basic structure in order to apply TDD, at this moment
we will create more complex tests.
The next example, will be based on Product class. This class will contains the
<code>name</code>, <code>price</code> variables and 2 methods:</p>

<pre><code>1) `isValid`: Verifies the state of itself is valid.
2) `getPriceWithCurrency`: Renders the price with currency.
</code></pre>

<h3 id="validating-product-s-name:2a5133cef429eb10f27e53c1a6baa385">Validating Product&rsquo;s name</h3>

<p>Create the <code>ProductTest.php</code> at test&rsquo;s folder.</p>

<pre><code>class ProductTest extends PHPUnit_Framework_TestCase
{
}
</code></pre>

<p>The first step is make a test to verify if the <code>name</code> attributes is really string.</p>

<pre><code>public function testShouldValidateNameIsString()
{
    $product       = new Product;
    $product-&gt;name = 123123;

    $this-&gt;assertFalse(
        $product-&gt;isValid(),
        'The name attributes is not a string'
    );
}
</code></pre>

<p>Run the <code>phpunit</code> at console:</p>

<pre><code>$ vendor/bin/phpunit
</code></pre>

<p><img src="https://dl.dropboxusercontent.com/u/106483810/tdd-phpunit-first-steps/Captura%20de%20Tela%202014-08-20%20%C3%A0s%2011.39.20.png" alt="" /></p>

<p>The error: <code>Fatal error: Class 'Product' not found</code>, was caused by non-existency <code>Product</code> class.</p>

<p>Create the class <code>Product</code> inside <code>src/</code> folder.</p>

<pre><code>&lt;?php

class Product
{
    public $name;
    public $price;
}
</code></pre>

<p>Add to <code>composer.json</code> after the <code>require-dev</code> key to map the classes inside <code>src/</code>:</p>

<pre><code>&quot;autoload&quot;: {
    &quot;classmap&quot;: [
        &quot;src&quot;
    ]
}
</code></pre>

<p>Let&rsquo;s run <code>composer.phar dumpautoload</code> to map all classes created.</p>

<pre><code>$ composer.phar dumpautoload
</code></pre>

<p>Let&rsquo;s run again the <code>phpunit</code>:</p>

<pre><code>$ vendor/bin/phpunit
</code></pre>

<p>Hmm&hellip; has a new kind of error (RED Phase):</p>

<p><img src="https://dl.dropboxusercontent.com/u/106483810/tdd-phpunit-first-steps/Captura%20de%20Tela%202014-08-20%20%C3%A0s%2011.55.46.png" alt="" /></p>

<p>This errors was caused by the method <code>isValid</code> was not implementing the
functionality to validate the <code>name</code> attribute.</p>

<p>Now, we will implement the <code>isValid()</code> method:</p>

<pre><code>public function isValid()
{
    if(! is_string($this-&gt;name)) {
        return false;
    }
}
</code></pre>

<p>Run again all tests (GREEN Phase):</p>

<pre><code>$ vendor/bin/phpunit
</code></pre>

<p><img src="https://dl.dropboxusercontent.com/u/106483810/tdd-phpunit-first-steps/Captura%20de%20Tela%202014-08-25%20%C3%A0s%2017.14.44.png" alt="" /></p>

<p>Now let&rsquo;s say if the <code>name</code> is empty, this test will cover? No, will not.
To be sure, let&rsquo;s create the following test:</p>

<pre><code>public function testShouldValidateNameISNotEmpty()
{
    $product       = new Product;
    $product-&gt;name = '';

    $this-&gt;assertFalse($product-&gt;isValid());
}
</code></pre>

<p>Run the all tests:</p>

<pre><code>$ vendor/bin/phpunit
</code></pre>

<p><img src="https://dl.dropboxusercontent.com/u/106483810/tdd-phpunit-first-steps/Captura%20de%20Tela%202014-08-20%20%C3%A0s%2018.08.11.png" alt="" /></p>

<p>As you can see the testing was failing, and now we should implement the following code.</p>

<pre><code>public function isValid()
{
    if(! $this-&gt;name || ! is_string($this-&gt;name)) {
        return false;
    }
}
</code></pre>

<p>Running all tests again:</p>

<pre><code>$ vendor/bin/phpunit
</code></pre>

<p><img src="https://dl.dropboxusercontent.com/u/106483810/tdd-phpunit-first-steps/Captura%20de%20Tela%202014-08-20%20%C3%A0s%2018.13.21.png" alt="" /></p>

<h4 id="let-s-refactor:2a5133cef429eb10f27e53c1a6baa385">Let&rsquo;s refactor</h4>

<p>Looking the <code>ProductTest.php</code>, you can note a little repetition in the code when
you are testing the <code>name</code> attribute when is empty or a valid string, we can
you can use a tool called <code>DataProvider</code> at PHPUnit.</p>

<p>Let&rsquo;s create a new function called &lsquo;invalidNames&rsquo; in <code>ProductTest.php</code>:</p>

<pre><code>public function invalidNames()
{
    return[
        [''],
        [123],
        [null]
    ];
}
</code></pre>

<p>Now you can <strong>remove</strong> all others method to validate &lsquo;name&rsquo; attributes, and implements the following code:</p>

<pre><code>/**
 * @dataProvider invalidNames
 */
public function testShouldValidateNameAttribute($value)
{
    $product       = new Product;
    $product-&gt;name = $value;

    $this-&gt;assertFalse($product-&gt;isValid());
}
</code></pre>

<p>A <code>Data Provider</code>, is a tool to remove data duplication when are you testing some repetitive
values.
To use this feature you need create a <code>public</code> method inside test class, returning all possible values.
The method&rsquo;s name should be write in a comment on the function with <code>@dataProvider</code>.
The values returned by the function will be passed as argument at the test.
At the example above, PHPUnit will run the test case function 3 times passing the returned values.</p>

<p>So far, we have created a validation of the <code>name</code> attribute, testing and refactor this method
using <code>@dataProvider</code> tool.</p>

<p>Running all tests, should be green.</p>

<p><img src="https://dl.dropboxusercontent.com/u/106483810/tdd-phpunit-first-steps/Captura%20de%20Tela%202014-08-25%20%C3%A0s%2017.20.21.png" alt="" /></p>

<h3 id="validating-product-s-price:2a5133cef429eb10f27e53c1a6baa385">Validating Product&rsquo;s price</h3>

<p>Now we will implement the next test case to <code>price</code> attributes, using <code>@dataProvider</code>.</p>

<pre><code>/**
 * @dataProvider invalidPrices
 */
public function testShouldValidatePriceAttribute($value)
{
    $product        = new Product;
    $product-&gt;name  = 'Drill';
    $product-&gt;price = $value;

    $this-&gt;assertFalse($product-&gt;isValid());
}

public function invalidPrices()
{
    return[
        [''],
        ['123123'],
        [null],
        ['some string']
    ];
}
</code></pre>

<p>Running the tests in terminal <code>$ vendor\bin\phpunit</code> you can see:</p>

<p><img src="https://dl.dropboxusercontent.com/u/106483810/tdd-phpunit-first-steps/Captura%20de%20Tela%202014-08-20%20%C3%A0s%2018.31.05.png" alt="" /></p>

<p>Now let&rsquo;s implement to make pass this tests.</p>

<pre><code>public function isValid()
{
    if(! $this-&gt;name || ! is_string($this-&gt;name)) {
        return false;
    }

    if(! $this-&gt;price || ! $this-&gt;hasPriceValid()) {
        return false;
    }

    return true;
}

protected function hasPriceValid()
{
    return is_float($this-&gt;price) || is_integer($this-&gt;price);
}
</code></pre>

<p>Running the tests in terminal <code>$ vendor\bin\phpunit</code> all is green.</p>

<p><img src="https://dl.dropboxusercontent.com/u/106483810/tdd-phpunit-first-steps/Captura%20de%20Tela%202014-08-25%20%C3%A0s%2017.17.34.png" alt="" /></p>

<p>Please, commit this changes:</p>

<pre><code>$ git add -A .
$ git commit -m 'Basic validation name and price fields'
</code></pre>

<h3 id="creating-getpricewithcurrency-method:2a5133cef429eb10f27e53c1a6baa385">Creating getPriceWithCurrency() method</h3>

<pre><code>public function testShouldReturnPriceWithCurrency()
{
    $product        = new Product;
    $product-&gt;price = 10;
    $expected       = &quot;$ 10&quot;;

    $this-&gt;assertEquals($expected, $product-&gt;getPriceWithCurrency());
}
</code></pre>

<p><img src="https://dl.dropboxusercontent.com/u/106483810/tdd-phpunit-first-steps/Captura%20de%20Tela%202014-08-20%20%C3%A0s%2018.37.39.png" alt="" /></p>

<pre><code>public function getPriceWithCurrency()
{
    return &quot;$ &quot; . $this-&gt;price;
}
</code></pre>

<p>Running all tests with &ldquo;vendor/bin/phpunit&rdquo;:</p>

<p><img src="https://dl.dropboxusercontent.com/u/106483810/tdd-phpunit-first-steps/Captura%20de%20Tela%202014-08-25%20%C3%A0s%2017.21.15.png" alt="" /></p>

<h3 id="commit-it-1:2a5133cef429eb10f27e53c1a6baa385">Commit it</h3>

<p>Please, commit this changes:</p>

<pre><code>$ git add -A .
$ git commit -m 'new getPriceWithCurrency() method has been created in order to return the price with currency as string'
</code></pre>

<h3 id="conclusion:2a5133cef429eb10f27e53c1a6baa385">Conclusion</h3>

<p>The TDD has a lot of benefits:</p>

<ul>
<li>Give confidences to refactor you code.</li>
<li>Creates a layer to knows if was a regression of our code.</li>
<li>If the feature is difficult to test, it&rsquo;s can mean a bad code design.</li>
</ul>

<p>The process of TDD is something that you will incorporate in our day-to-day.</p>

<p><img src="http://www.troll.me/images/disaster-girl/they-didnt-use-tdd.jpg" alt="" /></p>

<p>I&rsquo;ve heard people say:
    - &ldquo;TDD is complicated, I not know how to start&rdquo;.
    - &ldquo;I don`t know how to use TDD with my framework X&rdquo;.</p>

<p>I will explain how you can do this:</p>

<pre><code>- First create a branch.
- Start creating our first test.
</code></pre>

<p>The same way you learn to code, coding, this is valid for
learning tests, test something.</p>

<p><img src="https://dl.dropboxusercontent.com/u/106483810/tdd-phpunit-first-steps/tdd-magic.jpg" alt="" /></p>

<h3 id="links:2a5133cef429eb10f27e53c1a6baa385">Links</h3>

<p><a href="http://phpunit.de/manual/current/en/index.html">http://phpunit.de/manual/current/en/index.html</a></p>

<p><a href="http://phpunit.de/manual/current/en/appendixes.assertions.html">http://phpunit.de/manual/current/en/appendixes.assertions.html</a></p>

<p><a href="http://www.amazon.com/Growing-Object-Oriented-Software-Guided-Tests/dp/0321503627/ref=sr_1_1?ie=UTF8&amp;qid=undefined&amp;sr=8-1&amp;keywords=growing+object+oriented+software+guided+by+tests">http://www.amazon.com/Growing-Object-Oriented-Software-Guided-Tests/dp/0321503627/ref=sr_1_1?ie=UTF8&amp;qid=undefined&amp;sr=8-1&amp;keywords=growing+object+oriented+software+guided+by+tests</a></p>

<p><a href="https://leanpub.com/laravel-testing-decoded">https://leanpub.com/laravel-testing-decoded</a></p>

    </section>


  <footer class="post-footer">


    

    





<section class="author">
  <h4><a href="http://localhost:1313/">Guilherme Guitte</a></h4>
  
  <p>Read <a href="http://localhost:1313/">more posts</a> by this author.</p>
  
  <div class="author-meta">
    <span class="author-location icon-location">São Paulo, Brasil</span>
    <span class="author-link icon-link"><a href="http://www.guitte.org">http://www.guitte.org</a></span>
  </div>
</section>



    
    <section class="share">
      <h4>Share this post</h4>
      <a class="icon-twitter" style="font-size: 1.4em" href="https://twitter.com/share?text=TDD%20in%20practice%20with%20PHPUnit&amp;url=http%3a%2f%2flocalhost%3a1313%2ftdd-in-practice-with-phpunit%2f"
          onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
          <span class="hidden">Twitter</span>
      </a>
      <a class="icon-facebook" style="font-size: 1.4em" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2ftdd-in-practice-with-phpunit%2f"
          onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
          <span class="hidden">Facebook</span>
      </a>
      <a class="icon-google-plus" style="font-size: 1.4em" href="https://plus.google.com/share?url=http%3a%2f%2flocalhost%3a1313%2ftdd-in-practice-with-phpunit%2f"
         onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
          <span class="hidden">Google+</span>
      </a>
    </section>
    

    
    
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname = 'guitte-web-dev';
      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    
    

  </footer>
</article>

</main>
    <footer class="site-footer clearfix">
        <section class="copyright"><a href="">Guilherme Guitte</a> All rights reserved - 2015</section>
        
    </footer>
    </div>
    <script type="text/javascript" src="http://localhost:1313/js/jquery.js"></script>
    <script type="text/javascript" src="http://localhost:1313/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="http://localhost:1313/js/index.js"></script>

<script data-no-instant>document.write('<script src="http://'
        + (location.host || 'localhost').split(':')[0]
		+ ':1313/livereload.js?mindelay=10"></'
        + 'script>')</script></body>
</html>

